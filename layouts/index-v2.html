{{/*
  AINEXT V2 - 首頁入口
  這個檔案會被 layouts/_default/baseof-v2.html 使用
  請用 hugo server --layoutDir layouts-v2 預覽
*/}}

{{ define "main" }}
{{/* 直接 include layouts-v2/index.html 的內容 */}}

{{ $allPages := where .Site.RegularPages "Type" "posts" }}

<div class="homepage">

  {{/* Hero 區塊 */}}
  <section class="hero-section">
    <div class="hero-section__glance">
      <h2 class="glance-title">今日焦點</h2>
      <p class="glance-updated">更新於 {{ now.Format "15:04" }}</p>
      <ol class="headlines-list">
        {{ range $i, $page := first 6 $allPages }}
        <li class="headlines-list__item">
          <span class="headlines-list__number">{{ add $i 1 }}</span>
          <div class="headlines-list__content">
            {{ with $page.Params.categories }}
              {{ range first 1 . }}
              <span class="headlines-list__category">{{ . }}</span>
              {{ end }}
            {{ end }}
            <a href="{{ $page.Permalink }}">{{ $page.Title }}</a>
          </div>
        </li>
        {{ end }}
      </ol>
    </div>

    <div class="hero-section__main">
      {{ with index $allPages 0 }}
        {{ partial "v2/article-card.html" (dict "page" . "variant" "hero") }}
      {{ end }}
    </div>

    <div class="hero-section__sidebar">
      {{ range $allPages | first 4 | after 1 }}
        {{ partial "v2/article-card.html" (dict "page" . "variant" "small") }}
      {{ end }}
    </div>
  </section>

  {{/* 分類區塊 - 按分類動態顯示 */}}
  {{ range $index, $taxonomy := .Site.Taxonomies.categories }}
    {{ $categoryName := .Page.Title }}
    {{ $categoryPages := .Pages }}

    {{ if gt (len $categoryPages) 0 }}
    <section class="category-section">
      <div class="category-section__header">
        <h2 class="category-title">
          <a href="{{ .Page.Permalink }}">{{ $categoryName }}</a>
        </h2>
        <a href="{{ .Page.Permalink }}" class="category-section__more">查看全部 →</a>
      </div>

      {{ if eq (mod $index 2) 0 }}
      <div class="category-layout--b">
        {{ range $categoryPages | first 4 }}
          {{ partial "v2/article-card.html" (dict "page" . "variant" "default") }}
        {{ end }}
      </div>
      {{ else }}
      <div class="category-layout--c">
        {{ range $categoryPages | first 3 }}
          {{ partial "v2/article-card.html" (dict "page" . "variant" "default") }}
        {{ end }}
      </div>
      {{ end }}
    </section>
    {{ end }}
  {{ end }}

</div>
{{ end }}
